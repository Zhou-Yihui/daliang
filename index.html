<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<title>å¤§å‡‰è¯­è¾“å…¥æ³•å®‰å…¨ç‰ˆ</title>
<meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
<style>
:root{--theme:#7c4dff;--bg:#121212;--key:#1e1e1e;--text:#fff;--border:rgba(255,255,255,.15)}
*{box-sizing:border-box;font-family:Roboto,Helvetica Neue,PingFang SC}
body{margin:0;background:var(--bg);color:var(--text);height:100vh;display:flex;flex-direction:column}
header{height:48px;background:var(--theme);display:flex;align-items:center;padding:0 12px;font-weight:bold}
main{flex:1;display:flex;flex-direction:column}
#screen{flex:1;padding:12px;font-size:24px;background:#000;border:1px solid var(--border);overflow-y:auto;white-space:pre-wrap;word-break:break-all}
#toolbar{height:42px;display:flex;align-items:center;padding:0 8px;border-bottom:1px solid var(--border)}
#toolbar button{margin-left:auto;height:32px;border:none;border-radius:4px;background:var(--theme);color:#fff;padding:0 12px;cursor:pointer}
#candidate{height:46px;display:flex;align-items:center;padding:0 8px;border-bottom:1px solid var(--border);overflow-x:auto}
.cand-char{height:36px;margin:0 4px;border:1px solid var(--border);border-radius:4px;background:var(--key);display:flex;align-items:center;justify-content:center;cursor:pointer;flex-shrink:0}
.cand-char img{height:32px;width:auto;pointer-events:none}
#keyboard{height:260px;display:flex;flex-direction:column;background:var(--key)}
.row{display:flex;flex:1}
.key{flex:1;margin:3px;border-radius:6px;background:#2a2a2a;display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;transition:background .1s}
.key:active{background:var(--theme)}
.key.fn{font-size:14px;background:#333}
#drawPanel{position:fixed;inset:0;background:#000;display:flex;flex-direction:column;z-index:1000}
#drawTop{height:52px;background:var(--theme);display:flex;align-items:center;justify-content:space-between;padding:0 12px}
#drawCanvas{flex:1;background:#000;cursor:crosshair}
#drawTools{padding:8px;display:flex;gap:8px;flex-wrap:wrap}
.btn{background:var(--theme);border:0;color:#fff;padding:8px 14px;border-radius:4px;cursor:pointer}
input[type=file]{display:none}
label.btn{display:inline-block}
#status{position:fixed;bottom:4px;left:50%;transform:translateX(-50%);background:#000;border:1px solid var(--border);padding:4px 12px;border-radius:12px;font-size:12px;color:var(--theme)}
/* æ–°å¢ï¼šæœ¬åœ°ä¿å­˜æŒ‰é’®æ ·å¼ */
#localSaveBtn{margin-left:8px;background:#4CAF50}
</style>
</head>
<body>
<header>å¤§å‡‰è¯­è¾“å…¥æ³•å®‰å…¨ç‰ˆ</header>

<main>
  <div id="screen" contenteditable="true" placeholder="ç‚¹è¿™é‡Œè¾“å…¥â€¦"></div>
  <div id="toolbar">
    <span>å€™é€‰</span>
    <button onclick="openDraw()">âœï¸ ç»˜åˆ¶æ–°å­—ç¬¦</button>
  </div>
  <div id="candidate"></div>
  <div id="keyboard"></div>
</main>

<!-- æ‰‹å†™é¢æ¿ï¼šæ–°å¢æœ¬åœ°ä¿å­˜æŒ‰é’® -->
<div id="drawPanel" style="display:none">
  <div id="drawTop">
    <span>ç»˜åˆ¶æ–°å­—ç¬¦</span>
    <div>
      <input id="latinIn" placeholder="å¯¹åº”æ‹‰ä¸å­—æ¯" maxlength="20"/>
      <button class="btn" id="saveBtn" onclick="saveGlyph()">ä¿å­˜å¹¶ä¸Šä¼ (GitHub)</button>
      <button class="btn" id="localSaveBtn" onclick="saveGlyphLocally()">æœ¬åœ°ä¿å­˜(ä»…æœ¬è®¾å¤‡)</button>
      <button class="btn" onclick="closeDraw()">å…³é—­</button>
    </div>
  </div>
  <canvas id="drawCanvas"></canvas>
  <div id="drawTools">
    <label class="btn">ç¬”å®½<input type="range" id="brushW" min="2" max="40" value="6"></label>
    <button class="btn" onclick="toogleEraser()">æ©¡çš®æ“¦</button>
    <button class="btn" onclick="clearDraw()">æ¸…å±</button>
    <button class="btn" onclick="undoStroke()">æ’¤é”€</button>
    <label class="btn">ä¸Šä¼ åº•å›¾<input type="file" id="bgFile" accept="image/*"></label>
  </div>
</div>

<span id="status">å°±ç»ª</span>
<button onclick="location.reload()" style="position:fixed;bottom:60px;right:8px;height:32px;border:none;border-radius:4px;background:var(--theme);color:#fff;cursor:pointer">ğŸ”„ é‡è½½å­—ç¬¦</button>

<script>
/***************  é…ç½®  ****************/
const owner='Zhou-Yihui';   //  â† åªæ”¹è¿™é‡Œ
const repo='daliang';          //  ä»“åº“å
let token=localStorage.getItem('gtoken');
if(!token){
  token=prompt('GitHub Personal Access Tokenï¼ˆä»…æœ¬åœ°å­˜å‚¨ï¼Œæ°¸ä¸è¿›æºç ï¼‰');
  if(token)localStorage.setItem('gtoken',token);
}

/***************  å…¨å±€å˜é‡  ****************/
let layout='qwerty';
let page=0;
let shift=false;
let charTable={};
let imgBg;          // æ‰‹ç»˜åº•å›¾
let strokes=[],currStr=[];
let isDraw=false,isErase=false;
let drawCtx,canvas;
// æ–°å¢ï¼šæœ¬åœ°å­˜å‚¨é”®åï¼ˆé¿å…ä¸å…¶ä»–æ•°æ®å†²çªï¼‰
const LOCAL_CHAR_KEY='daliang_char_table';

/***************  åˆå§‹åŒ–  ****************/
window.onload=()=>{
  canvas=document.getElementById('drawCanvas');
  drawCtx=canvas.getContext('2d');
  resizeCanvas();
  window.addEventListener('resize',resizeCanvas);
  bindDrawEvents();
  // æ”¹åŠ¨ï¼šä¼˜å…ˆåŠ è½½æœ¬åœ°å­—ç¬¦è¡¨ï¼Œå†åŒæ­¥è¿œç¨‹
  loadLocalTable();
  loadRemoteTable().then(()=>{
    renderKB();
    bindIME();
  });
};
function resizeCanvas(){
  canvas.width=canvas.clientWidth;
  canvas.height=canvas.clientHeight;
  if(imgBg)drawCtx.drawImage(imgBg,0,0,canvas.width,canvas.height);
}

/***************  GitHub API  ****************/
async function gh(method,path,body){
  const res=await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`,{
    method,headers:{Authorization:`token ${token}`,'Content-Type':'application/json'},
    body:body?JSON.stringify(body):undefined
  });
  if(!res.ok)throw new Error(await res.text());
  return res.json();
}
async function loadRemoteTable(){
  status('åŒæ­¥è¿œç¨‹å­—ç¬¦è¡¨â€¦');
  try{
    const {content}=await gh('GET','table.json');
    const remoteTable=JSON.parse(atob(content));
    // æ”¹åŠ¨ï¼šåˆå¹¶è¿œç¨‹è¡¨åˆ°æœ¬åœ°è¡¨ï¼ˆé¿å…è¦†ç›–æœ¬åœ°æ•°æ®ï¼‰
    for(const [latin, chars] of Object.entries(remoteTable)){
      if(!charTable[latin])charTable[latin]=[];
      // å»é‡ï¼šé¿å…é‡å¤æ·»åŠ ç›¸åŒå›¾ç‰‡
      const existingUrls=charTable[latin].map(c=>c.url);
      const newChars=chars.filter(c=>!existingUrls.includes(c.url));
      charTable[latin]=[...charTable[latin],...newChars];
    }
    // åˆå¹¶åä¿å­˜åˆ°æœ¬åœ°
    saveLocalTable();
    status('è¿œç¨‹åŒæ­¥å®Œæˆ');
  }catch(e){
    if(e.message.includes('Not Found')){status('è¿œç¨‹æ— è¡¨ï¼Œä½¿ç”¨æœ¬åœ°è¡¨');}
    else status('åŒæ­¥å¤±è´¥ '+e.message);
  }
}
async function pushToGit(path,content,message){
  let sha;
  try{sha=(await gh('GET',path)).sha;}catch(e){}
  await gh('PUT',path,{
    message:message||'update '+path,
    content:btoa(typeof content==='string'?content:JSON.stringify(content)),
    sha
  });
}

/***************  æ–°å¢ï¼šæœ¬åœ°å­—ç¬¦è¡¨æ“ä½œ  ****************/
// åŠ è½½æœ¬åœ°å­—ç¬¦è¡¨
function loadLocalTable(){
  status('åŠ è½½æœ¬åœ°å­—ç¬¦è¡¨â€¦');
  try{
    const localData=localStorage.getItem(LOCAL_CHAR_KEY);
    if(localData)charTable=JSON.parse(localData);
    status('æœ¬åœ°è¡¨åŠ è½½å®Œæˆ');
  }catch(e){
    status('æœ¬åœ°è¡¨æŸåï¼Œæ–°å»º');
    charTable={};
    saveLocalTable();
  }
}
// ä¿å­˜å­—ç¬¦è¡¨åˆ°æœ¬åœ°
function saveLocalTable(){
  try{
    localStorage.setItem(LOCAL_CHAR_KEY,JSON.stringify(charTable));
  }catch(e){
    status('æœ¬åœ°ä¿å­˜å¤±è´¥ï¼š'+e.message);
  }
}
// æœ¬åœ°ä¿å­˜å•ä¸ªå­—ç¬¦ï¼ˆä¸ä¸Šä¼ GitHubï¼‰
function saveGlyphLocally(){
  const latin=document.getElementById('latinIn').value.trim().toLowerCase();
  if(!latin){alert('è¯·è¾“å…¥æ‹‰ä¸é”®');return;}
  if(!strokes.length){alert('è¯·ç»˜åˆ¶å­—ç¬¦');return;}

  try{
    // 1. ç”Ÿæˆå›¾ç‰‡Blobå¹¶è·å–æœ¬åœ°URL
    canvas.toBlob(blob=>{
      const localUrl=URL.createObjectURL(blob);
      // 2. ä¿å­˜åˆ°æœ¬åœ°å­—ç¬¦è¡¨
      if(!charTable[latin])charTable[latin]=[];
      const newRec={
        url:localUrl,
        type:'local', // æ ‡è®°ä¸ºæœ¬åœ°å­—ç¬¦
        timestamp:Date.now()
      };
      charTable[latin].push(newRec);
      // 3. ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
      saveLocalTable();
      // 4. ç«‹å³æ·»åŠ åˆ°å€™é€‰æ 
      insertLocalCand(newRec);
      // 5. ä¸‹è½½å›¾ç‰‡åˆ°æœ¬åœ°ï¼ˆå¯é€‰ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨ä¿å­˜ï¼‰
      const a=document.createElement('a');
      a.href=localUrl;
      a.download=`daliang_${latin}_${Date.now()}.png`;
      a.click();
      URL.revokeObjectURL(localUrl); // é‡Šæ”¾URL

      status('âœ… æœ¬åœ°ä¿å­˜æˆåŠŸï¼');
      clearDraw();
      document.getElementById('latinIn').value='';
    });
  }catch(e){
    status('æœ¬åœ°ä¿å­˜å¤±è´¥: '+e.message);
    alert('æœ¬åœ°ä¿å­˜å¤±è´¥\n'+e.message);
  }
}

/***************  æ‰‹ç»˜  ****************/
function bindDrawEvents(){
  const down=e=>{
    isDraw=true;currStr=[];const {x,y}=getXY(e);
    drawCtx.beginPath();drawCtx.moveTo(x,y);currStr.push({x,y});
  };
  const move=e=>{
    if(!isDraw)return;const {x,y}=getXY(e);
    drawCtx.lineWidth=isErase?document.getElementById('brushW').value*2:document.getElementById('brushW').value;
    drawCtx.globalCompositeOperation=isErase?'destination-out':'source-over';
    drawCtx.strokeStyle='#fff';drawCtx.lineTo(x,y);drawCtx.stroke();
    currStr.push({x,y});
  };
  const up=()=>{isDraw=false;if(currStr.length)strokes.push([...currStr]);};
  canvas.onmousedown=down;canvas.onmousemove=move;canvas.onmouseup=up;canvas.onmouseout=up;
  canvas.ontouchstart=e=>{e.preventDefault();down(e.touches[0]);};
  canvas.ontouchmove=e=>{e.preventDefault();move(e.touches[0]);};
  canvas.ontouchend=up;
  document.getElementById('bgFile').onchange=e=>{
    const file=e.target.files[0];if(!file)return;
    imgBg=new Image();imgBg.onload=()=>{drawCtx.drawImage(imgBg,0,0,canvas.width,canvas.height);};
    imgBg.src=URL.createObjectURL(file);
  };
}
function getXY(e){const r=canvas.getBoundingClientRect();return{x:e.clientX-r.left,y:e.clientY-r.top};}
function clearDraw(){drawCtx.clearRect(0,0,canvas.width,canvas.height);if(imgBg)drawCtx.drawImage(imgBg,0,0,canvas.width,canvas.height);strokes=[];}
function undoStroke(){strokes.pop();clearDraw();redrawStrokes();}
function redrawStrokes(){drawCtx.save();drawCtx.strokeStyle='#fff';drawCtx.lineWidth=document.getElementById('brushW').value;drawCtx.lineCap='round';strokes.forEach(s=>{if(s.length){drawCtx.beginPath();drawCtx.moveTo(s[0].x,s[0].y);s.forEach(p=>drawCtx.lineTo(p.x,p.y));drawCtx.stroke();}});drawCtx.restore();}
function toogleEraser(){isErase=!isErase;status(isErase?'æ©¡çš®æ“¦':'ç»˜åˆ¶');}
function openDraw(){document.getElementById('drawPanel').style.display='flex';resizeCanvas();}
function closeDraw(){document.getElementById('drawPanel').style.display='none';}

/* ========== ä¿å­˜å¹¶ä¸Šä¼ ï¼ˆç«‹å³å¯ç”¨+rawåŸŸå+20å­—æ¯ï¼‰ ========== */
async function saveGlyph(){
  const latin=document.getElementById('latinIn').value.trim().toLowerCase();
  if(!latin){alert('è¯·è¾“å…¥æ‹‰ä¸é”®');return;}
  if(!strokes.length){alert('è¯·ç»˜åˆ¶å­—ç¬¦');return;}
  const btn=document.getElementById('saveBtn');
  btn.disabled=true; btn.textContent='ä¸Šä¼ ä¸­â€¦';
  try{
    /* 1. ç”Ÿæˆ PNG */
    const blob=await new Promise(res=>drawCtx.canvas.toBlob(res));
    const base64=await new Promise(r=>{
      const reader=new FileReader();
      reader.onload=()=>r(reader.result.split(',')[1]);
      reader.readAsDataURL(blob);
    });
    const filename=`chars/${latin}_${Date.now()}.png`;

    /* 2. æ¨åˆ° GitHub = äºŒè¿›åˆ¶æ–‡ä»¶ï¼ŒéBase64æ–‡æœ¬ */
    await pushToGit(filename,base64,'add char '+latin);

    /* 3. æœ¬åœ°æ˜ å°„è¡¨ç«‹å³ç”Ÿæ•ˆï¼ˆæ— éœ€ç­‰åŒæ­¥ï¼‰+ å…¼å®¹å›½å†…è®¿é—®ï¼ˆæ–°å¢GitHubé•œåƒé“¾æ¥ï¼‰ */
    if(!charTable[latin])charTable[latin]=[];
    // æ”¹åŠ¨ï¼šæ·»åŠ  GitHub å®˜æ–¹é“¾æ¥ + å›½å†…é•œåƒé“¾æ¥ï¼ˆè§£å†³rawè®¿é—®é—®é¢˜ï¼‰
    const newRec={
      url:`https://raw.githubusercontent.com/${owner}/${repo}/main/${filename}`,
      mirrorUrl:`https://github.moeyy.xyz/https://raw.githubusercontent.com/${owner}/${repo}/main/${filename}`, // å›½å†…é•œåƒ
      filename,
      type:'remote'
    };
    charTable[latin].push(newRec);

    /* 4. è¿œç¨‹ä¹Ÿæ›´æ–° */
    await pushToGit('table.json',JSON.stringify(charTable,null,2),'update table');

    /* 5. ç«‹å³å¡è¿›å€™é€‰æ ï¼Œç”¨æˆ·é©¬ä¸Šèƒ½ç”¨ï¼ˆä¼˜å…ˆç”¨é•œåƒé“¾æ¥ï¼‰ */
    insertLocalCand({...newRec, url:newRec.mirrorUrl});

    /* 6. æœ¬åœ°ä¿å­˜ä¸€ä»½ï¼Œé¿å…åˆ·æ–°ä¸¢å¤± */
    saveLocalTable();

    status('âœ… å·²ä¿å­˜å¹¶ç”Ÿæ•ˆï¼');
    clearDraw();          // æ¸…ç©ºç”»å¸ƒ
    document.getElementById('latinIn').value=''; // æ¸…ç©ºæ‹‰ä¸æ¡†
    closeDraw();          // å…³é—­æ‰‹ç»˜æ¿
  }catch(e){
    status('ä¿å­˜å¤±è´¥: '+e.message);
    alert('ä¿å­˜å¤±è´¥\n'+e.message);
  }finally{
    btn.disabled=false; btn.textContent='ä¿å­˜å¹¶ä¸Šä¼ (GitHub)'; // æ¢å¤æŒ‰é’®
  }
}
/* æŠŠæ–°å­—ç¬¦ç«‹å³æ’å…¥å½“å‰å€™é€‰æ ï¼ˆæœ¬åœ°ç«‹å³å¯ç”¨ï¼‰ */
function insertLocalCand(rec){
  const box=document.getElementById('candidate');
  const div=document.createElement('div');div.className='cand-char';
  const img=new Image();
  // æ”¹åŠ¨ï¼šå›¾ç‰‡åŠ è½½å¤±è´¥æ—¶é™çº§ï¼ˆç”¨é•œåƒé“¾æ¥/æ˜¾ç¤ºæ–‡å­—å ä½ï¼‰
  img.src=rec.url;
  img.onerror=()=>{
    // 1. å°è¯•é•œåƒé“¾æ¥
    if(rec.mirrorUrl){
      img.src=rec.mirrorUrl;
    }else{
      // 2. æ— é•œåƒåˆ™æ˜¾ç¤ºæ–‡å­—å ä½
      div.innerHTML=`${rec.url.split('/').pop().slice(0,3)}`;
      div.style.fontSize='12px';
    }
  };
  div.appendChild(img);
  // æ”¹åŠ¨ï¼šè¾“å…¥æ¡†æ’å…¥
      div.onclick=()=>{
        const scr=document.getElementById('screen');
        const charContainer=document.createElement('span');
        charContainer.style.display='inline-block';
        charContainer.style.verticalAlign='middle';
        
        const im=new Image();
        im.src=rec.url;
        im.style.height='1em';
        im.onerror=()=>{
          // å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºå ä½æ–‡æœ¬
          charContainer.textContent=`[${rec.url.split('/').pop().slice(0,2)}]`;
          charContainer.style.color='#ccc';
        };
        charContainer.appendChild(im);
        scr.appendChild(charContainer);
        scr.appendChild(document.createTextNode(' '));
      };
      box.appendChild(div);
    }

    /***************  é”®ç›˜ & å€™é€‰  ****************/
    const LAYOUTS={
      qwerty:[
        ['q','w','e','r','t','y','u','i','o','p'],
        ['a','s','d','f','g','h','j','k','l'],
        ['â‡§','z','x','c','v','b','n','m','âŒ«'],
        ['123','ğŸ¤',' ','â']
      ],
      digit:[
        ['1','2','3','4','5','6','7','8','9','0'],
        ['-','/',':',';','(',')','$','&','@','"'],
        ['#+=','.',',','?','!','\'','â‡§','âŒ«'],
        ['ABC','ğŸ¤',' ','â']
      ]
    };
    function renderKB(){
      const kb=document.getElementById('keyboard');
      kb.innerHTML='';
      const lay=(layout==='digit'?LAYOUTS.digit:LAYOUTS.qwerty);
      lay.forEach(row=>{
        const r=document.createElement('div');r.className='row';
        row.forEach(k=>{
          const key=document.createElement('div');key.className='key';key.textContent=k;
          if(k==='â‡§'||k==='123'||k==='ABC'||k==='ğŸ¤'||k==='â'||k==='âŒ«'||k==='#+=')key.classList.add('fn');
          // æ”¹åŠ¨ï¼šShifté”®æ·»åŠ è§†è§‰åé¦ˆ
          if(k==='â‡§'&&shift)key.style.background='var(--theme)';
          key.onclick=()=>handleKey(k);
          r.appendChild(key);
        });
        kb.appendChild(r);
      });
    }
    function handleKey(k){
      const scr=document.getElementById('screen');
      if(k==='â‡§'){shift=!shift;renderKB();return;}
      if(k==='âŒ«'){
        // æ”¹åŠ¨ï¼šæ”¯æŒåˆ é™¤å›¾ç‰‡/æ–‡æœ¬ï¼ˆå…¼å®¹å¯Œæ–‡æœ¬ï¼‰
        const lastChild=scr.lastChild;
        if(lastChild?.nodeType===3&&lastChild.textContent.trim()===''){
          scr.removeChild(lastChild);
        }
        if(scr.lastChild)scr.removeChild(scr.lastChild);
        return;
      }
      if(k==='â'){scr.appendChild(document.createElement('br'));return;}
      if(k==='123'){layout='digit';renderKB();return;}
      if(k==='ABC'){layout='qwerty';renderKB();return;}
      if(k==='ğŸ¤'){status('è¯­éŸ³æ¥å£é¢„ç•™');return;}
      if(k===' '){scr.appendChild(document.createTextNode(' '));return;}
      const l=(shift?k.toUpperCase():k);
      // æ”¹åŠ¨ï¼šè¾“å…¥æ‹‰ä¸å­—æ¯æ—¶æ·»åŠ è§†è§‰åé¦ˆ
      const textNode=document.createTextNode(l);
      scr.appendChild(textNode);
      updateCand(l);
      // è‡ªåŠ¨å–æ¶ˆShiftï¼ˆæ¨¡æ‹ŸçœŸå®é”®ç›˜ï¼‰
      if(shift&&!['â‡§','123','ABC'].includes(k)){
        shift=false;
        renderKB();
      }
    }
    function updateCand(l){
      const box=document.getElementById('candidate');
      box.innerHTML='';
      const list=charTable[l]||[];
      if(!list.length){
        box.innerHTML='<em style="color:#666">æ— å€™é€‰</em>';
        return;
      }
      list.forEach(it=>{
        const div=document.createElement('div');div.className='cand-char';
        const img=new Image();
        // ä¼˜å…ˆä½¿ç”¨é•œåƒé“¾æ¥ï¼ˆè§£å†³å›½å†…è®¿é—®é—®é¢˜ï¼‰
        img.src=it.mirrorUrl||it.url;
        img.style.height='32px';
        img.onerror=()=>{
          // å›¾ç‰‡åŠ è½½å¤±è´¥æ—¶æ˜¾ç¤ºå ä½
          div.innerHTML=`${it.url.split('/').pop().slice(0,2)}`;
          div.style.fontSize='12px';
          div.style.color='#ccc';
        };
        div.appendChild(img);
        div.onclick=()=>{
          const scr=document.getElementById('screen');
          const charContainer=document.createElement('span');
          charContainer.style.display='inline-block';
          charContainer.style.verticalAlign='middle';
          
          const im=new Image();
          im.src=it.mirrorUrl||it.url;
          im.style.height='1em';
          im.onerror=()=>{
            charContainer.textContent=`[${it.url.split('/').pop().slice(0,2)}]`;
            charContainer.style.color='#ccc';
          };
          charContainer.appendChild(im);
          scr.appendChild(charContainer);
          scr.appendChild(document.createTextNode(' '));
        };
        box.appendChild(div);
      });
    }
    function bindIME(){
      let timer;
      const scr=document.getElementById('screen');
      scr.addEventListener('touchstart',e=>{
        timer=setTimeout(()=>{
          openDraw();
          e.preventDefault();
        },500);
      });
      scr.addEventListener('touchend',()=>clearTimeout(timer));
      // æ–°å¢ï¼šç¦æ­¢è¾“å…¥æ¡†é»˜è®¤æ¢è¡Œï¼ˆä¼˜åŒ–ç§»åŠ¨ç«¯ä½“éªŒï¼‰
      scr.addEventListener('keydown',e=>{
        if(e.key==='Enter'&&!e.ctrlKey){
          e.preventDefault();
          scr.appendChild(document.createElement('br'));
        }
      });
    }
    function status(msg){
      const statusEl=document.getElementById('status');
      statusEl.textContent=msg;
      // çŠ¶æ€3ç§’åè‡ªåŠ¨æ¸…ç©ºï¼ˆé¿å…å¹²æ‰°ï¼‰
      clearTimeout(statusEl.timer);
      statusEl.timer=setTimeout(()=>{
        statusEl.textContent='å°±ç»ª';
      },3000);
    }
  </script>
</body>
</html>
